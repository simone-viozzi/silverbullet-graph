var U=Object.defineProperty;var d=(e,t)=>{for(var o in t)U(e,o,{get:t[o],enumerable:!0})};var P=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var C=new Map,x=0;function m(e){self.postMessage(e)}P&&(globalThis.syscall=async(e,...t)=>await new Promise((o,n)=>{x++,C.set(x,{resolve:o,reject:n}),m({type:"sys",id:x,name:e,args:t})}));function b(e,t){P&&(self.addEventListener("message",o=>{(async()=>{let n=o.data;switch(n.type){case"inv":{let a=e[n.name];if(!a)throw new Error(`Function not loaded: ${n.name}`);try{let c=await Promise.resolve(a(...n.args||[]));m({type:"invr",id:n.id,result:c})}catch(c){console.error("An exception was thrown as a result of invoking function",n.name,"error:",c.message),m({type:"invr",id:n.id,error:c.message})}}break;case"sysr":{let a=n.id,c=C.get(a);if(!c)throw Error("Invalid request id");C.delete(a),n.error?c.reject(new Error(n.error)):c.resolve(n.result)}break}})().catch(console.error)}),m({type:"manifest",manifest:t}))}function E(e){let t=atob(e),o=t.length,n=new Uint8Array(o);for(let a=0;a<o;a++)n[a]=t.charCodeAt(a);return n}function w(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",o=e.byteLength;for(let n=0;n<o;n++)t+=String.fromCharCode(e[n]);return btoa(t)}async function Y(e,t){if(typeof e!="string"){let o=new Uint8Array(await e.arrayBuffer()),n=o.length>0?w(o):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:n},e=e.url}return syscall("sandboxFetch.fetch",e,t)}globalThis.nativeFetch=globalThis.fetch;function j(){globalThis.fetch=async function(e,t){let o=t&&t.body?w(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,n=await Y(e,t&&{method:t.method,headers:t.headers,base64Body:o});return new Response(n.base64Body?E(n.base64Body):null,{status:n.status,headers:n.headers})}}P&&j();var g={};d(g,{confirm:()=>xe,copyToClipboard:()=>Fe,deleteLine:()=>ke,dispatch:()=>ye,downloadFile:()=>ie,filterBox:()=>ce,flashNotification:()=>ae,fold:()=>Ie,foldAll:()=>be,getCurrentPage:()=>N,getCursor:()=>O,getSelection:()=>V,getText:()=>B,getUiOption:()=>Ce,goHistory:()=>ne,hidePanel:()=>ue,insertAtCursor:()=>fe,insertAtPos:()=>ge,moveCursor:()=>de,moveCursorToLine:()=>me,navigate:()=>q,newWindow:()=>oe,openCommandPalette:()=>$,openPageNavigator:()=>z,openSearchPanel:()=>Ke,openUrl:()=>re,prompt:()=>he,redo:()=>Se,reloadConfigAndCommands:()=>te,reloadPage:()=>_,reloadUI:()=>ee,replaceRange:()=>pe,save:()=>H,setSelection:()=>X,setText:()=>J,setUiOption:()=>Pe,showPanel:()=>le,toggleFold:()=>ve,undo:()=>Ge,unfold:()=>Ae,unfoldAll:()=>we,uploadFile:()=>se,vimEx:()=>Ze});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function r(e,...t){return globalThis.syscall(e,...t)}function N(){return r("editor.getCurrentPage")}function B(){return r("editor.getText")}function J(e,t=!1){return r("editor.setText",e,t)}function O(){return r("editor.getCursor")}function V(){return r("editor.getSelection")}function X(e,t){return r("editor.setSelection",e,t)}function H(){return r("editor.save")}function q(e,t=!1,o=!1){return r("editor.navigate",e,t,o)}function z(e="page"){return r("editor.openPageNavigator",e)}function $(){return r("editor.openCommandPalette")}function _(){return r("editor.reloadPage")}function ee(){return r("editor.reloadUI")}function te(){return r("editor.reloadConfigAndCommands")}function re(e,t=!1){return r("editor.openUrl",e,t)}function oe(){return r("editor.newWindow")}function ne(e){return r("editor.goHistory",e)}function ie(e,t){return r("editor.downloadFile",e,t)}function se(e,t){return r("editor.uploadFile",e,t)}function ae(e,t="info"){return r("editor.flashNotification",e,t)}function ce(e,t,o="",n=""){return r("editor.filterBox",e,t,o,n)}function le(e,t,o,n=""){return r("editor.showPanel",e,t,o,n)}function ue(e){return r("editor.hidePanel",e)}function ge(e,t){return r("editor.insertAtPos",e,t)}function pe(e,t,o){return r("editor.replaceRange",e,t,o)}function de(e,t=!1){return r("editor.moveCursor",e,t)}function me(e,t=1,o=!1){return r("editor.moveCursorToLine",e,t,o)}function fe(e){return r("editor.insertAtCursor",e)}function ye(e){return r("editor.dispatch",e)}function he(e,t=""){return r("editor.prompt",e,t)}function xe(e){return r("editor.confirm",e)}function Ce(e){return r("editor.getUiOption",e)}function Pe(e,t){return r("editor.setUiOption",e,t)}function Ie(){return r("editor.fold")}function Ae(){return r("editor.unfold")}function ve(){return r("editor.toggleFold")}function be(){return r("editor.foldAll")}function we(){return r("editor.unfoldAll")}function Ge(){return r("editor.undo")}function Se(){return r("editor.redo")}function Ke(){return r("editor.openSearchPanel")}function Fe(e){return r("editor.copyToClipboard",e)}function ke(){return r("editor.deleteLine")}function Ze(e){return r("editor.vimEx",e)}var f={};d(f,{deleteAttachment:()=>Ne,deleteFile:()=>Xe,deletePage:()=>De,fileExists:()=>He,getAttachmentMeta:()=>Ee,getFileMeta:()=>Oe,getPageMeta:()=>We,listAttachments:()=>Ue,listFiles:()=>Be,listPages:()=>Me,listPlugs:()=>Qe,readAttachment:()=>Ye,readFile:()=>Je,readPage:()=>Le,writeAttachment:()=>je,writeFile:()=>Ve,writePage:()=>Te});function Me(){return r("space.listPages")}function We(e){return r("space.getPageMeta",e)}function Le(e){return r("space.readPage",e)}function Te(e,t){return r("space.writePage",e,t)}function De(e){return r("space.deletePage",e)}function Qe(){return r("space.listPlugs")}function Ue(){return r("space.listAttachments")}function Ee(e){return r("space.getAttachmentMeta",e)}function Ye(e){return r("space.readAttachment",e)}function je(e,t){return r("space.writeAttachment",e,t)}function Ne(e){return r("space.deleteAttachment",e)}function Be(){return r("space.listFiles")}function Je(e){return r("space.readFile",e)}function Oe(e){return r("space.getFileMeta",e)}function Ve(e,t){return r("space.writeFile",e,t)}function Xe(e){return r("space.deleteFile",e)}function He(e){return r("space.fileExists",e)}var y={};d(y,{applyAttributeExtractors:()=>tt,getEnv:()=>it,getMode:()=>st,getSpaceConfig:()=>rt,getVersion:()=>at,invokeCommand:()=>ze,invokeFunction:()=>qe,invokeSpaceFunction:()=>et,listCommands:()=>$e,listSyscalls:()=>_e,reloadConfig:()=>nt,reloadPlugs:()=>ot});function qe(e,...t){return r("system.invokeFunction",e,...t)}function ze(e,t){return r("system.invokeCommand",e,t)}function $e(){return r("system.listCommands")}function _e(){return r("system.listSyscalls")}function et(e,...t){return r("system.invokeSpaceFunction",e,...t)}function tt(e,t,o){return r("system.applyAttributeExtractors",e,t,o)}async function rt(e,t){return await r("system.getSpaceConfig",e)??t}function ot(){return r("system.reloadPlugs")}function nt(){return r("system.reloadConfig")}function it(){return r("system.getEnv")}function st(){return r("system.getMode")}function at(){return r("system.getVersion")}var h={};d(h,{readAsset:()=>ft});function mt(e){let t=atob(e),o=t.length,n=new Uint8Array(o);for(let a=0;a<o;a++)n[a]=t.charCodeAt(a);return n}function G(e){let t=e.split(",",2)[1];return mt(t)}async function ft(e,t,o="utf8"){let n=await r("asset.readAsset",e,t);switch(o){case"utf8":return new TextDecoder().decode(G(n));case"dataurl":return n}}var p={};d(p,{batchDel:()=>wt,batchGet:()=>vt,batchSet:()=>It,del:()=>bt,get:()=>At,listFunctions:()=>Kt,query:()=>Gt,queryDelete:()=>St,set:()=>Pt});function Pt(e,t){return r("datastore.set",e,t)}function It(e){return r("datastore.batchSet",e)}function At(e){return r("datastore.get",e)}function vt(e){return r("datastore.batchGet",e)}function bt(e){return r("datastore.delete",e)}function wt(e){return r("datastore.batchDelete",e)}function Gt(e,t={}){return r("datastore.query",e,t)}function St(e,t){return r("datastore.queryDelete",e,t)}function Kt(){return r("datastore.listFunctions")}var Zt=Object.create,A=Object.defineProperty,Rt=Object.getOwnPropertyDescriptor,Mt=Object.getOwnPropertyNames,Wt=Object.getPrototypeOf,Lt=Object.prototype.hasOwnProperty,Tt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Dt=(e,t)=>{for(var o in t)A(e,o,{get:t[o],enumerable:!0})},I=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Mt(t))!Lt.call(e,a)&&a!==o&&A(e,a,{get:()=>t[a],enumerable:!(n=Rt(t,a))||n.enumerable});return e},Qt=(e,t,o)=>(I(e,t,"default"),o&&I(o,t,"default")),K=(e,t,o)=>(o=e!=null?Zt(Wt(e)):{},I(t||!e||!e.__esModule?A(o,"default",{value:e,enumerable:!0}):o,e)),F=Tt(e=>{e.compile=function(c){var s=e.parse(c),i=s[0],u=s[1];return{accepts:function(l){return l[0]==="/"&&(l=l.slice(1)),u[0].test(l)||!i[0].test(l)},denies:function(l){return l[0]==="/"&&(l=l.slice(1)),!(u[0].test(l)||!i[0].test(l))},maybe:function(l){return l[0]==="/"&&(l=l.slice(1)),u[1].test(l)||!i[1].test(l)}}},e.parse=function(c){return c.split(`
`).map(function(s){return s=s.trim(),s}).filter(function(s){return s&&s[0]!=="#"}).reduce(function(s,i){var u=i[0]==="!";return u&&(i=i.slice(1)),i[0]==="/"&&(i=i.slice(1)),u?s[1].push(i):s[0].push(i),s},[[],[]]).map(function(s){return s.sort().map(t).reduce(function(i,u){return i[0].push(u[0]),i[1].push(u[1]),i},[[],[],[]])}).map(function(s){return[s[0].length>0?new RegExp("^(("+s[0].join(")|(")+"))"):new RegExp("$^"),s[1].length>0?new RegExp("^(("+s[1].join(")|(")+"))"):new RegExp("$^")]})};function t(c){return[o(c),n(c)]}function o(c){return a(c).replace("**","(.+)").replace("*","([^\\/]+)")}function n(c){return c.split("/").map(function(s,i){return i?"([\\/]?("+o(s)+"\\b|$))":"("+o(s)+"\\b)"}).join("")}function a(c){return c.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")}}),k={};Dt(k,{compile:()=>v,default:()=>R,parse:()=>Ut});var Z=K(F());Qt(k,K(F()));var{compile:v,parse:Ut}=Z,{default:S,...Et}=Z,R=S!==void 0?S:Et;async function Yt(){let e=await y.getSpaceConfig();console.log("Full Space Config:",JSON.stringify(e,null,2));let t=e.graph?.excludeRegex||[],o=e.graph?.excludeTags||[],n=v(t.join(`
`)).accepts;return console.log("Compiled fileFilterFn:",n),console.log("Exclude Tags:",o),{fileFilterFn:n,excludeTags:o}}async function M(){let{fileFilterFn:e,excludeTags:t}=await Yt(),o=(await f.listPages()).filter(i=>e(i.name)&&!i.tags?.some(u=>t.includes(u))),a=(await p.query({type:"link"})).filter(i=>i.value.tag==="link"&&i.value.toPage?.trim()).map(i=>({source:i.value.page,target:i.value.toPage})).filter(i=>e(i.source)&&e(i.target)),s={nodes:o.map(i=>({id:i.name,title:i.name,tags:i.tags||[],created:i.created,lastModified:i.lastModified})),links:a};console.log("Generated graph data:",JSON.stringify(s,null,2)),await p.set(["graph","main"],s),console.log("Graph saved to datastore:",s),await g.flashNotification("Graph saved to datastore!")}async function W(){await p.del(["graph","main"]),await g.flashNotification("Graph data cleared from datastore!")}async function L(e,t){let o=await p.get(["graph","main"]);return o?{html:'<div id="graph-container" style="width: 100%; height: 500px; border: 1px solid #ccc;"></div>',script:`
      loadJsByUrl("https://d3js.org/d3.v7.min.js").then(() => {
        ${await h.readAsset("graph","assets/graph_widget.js")}
        renderGraph(${JSON.stringify(o)});
      });
    `}:{html:"<div>Graph data not found in datastore. Please save a graph first!</div>"}}async function T(){await g.flashNotification("Hello world!")}var D={saveGraph:M,clearGraphData:W,graphWidget:L,hello:T},Q={name:"graph",version:.1,imports:["https://get.silverbullet.md/global.plug.json"],assets:{"assets/graph_widget.js":{data:"data:application/javascript;base64,ZnVuY3Rpb24gcmVuZGVyR3JhcGgoZ3JhcGhEYXRhKSB7CiAgY29uc3Qgd2lkdGggPSA2MDAsIGhlaWdodCA9IDQwMDsKCiAgLy8gQ3JlYSBsJ1NWRwogIGNvbnN0IHN2ZyA9IGQzLnNlbGVjdCgiI2dyYXBoLWNvbnRhaW5lciIpCiAgICAuYXBwZW5kKCJzdmciKQogICAgLmF0dHIoIndpZHRoIiwgd2lkdGgpCiAgICAuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KTsKCiAgLy8gU2ltdWxhemlvbmUgZGkgbGF5b3V0CiAgY29uc3Qgc2ltdWxhdGlvbiA9IGQzLmZvcmNlU2ltdWxhdGlvbihncmFwaERhdGEubm9kZXMpCiAgICAuZm9yY2UoImxpbmsiLCBkMy5mb3JjZUxpbmsoZ3JhcGhEYXRhLmxpbmtzKS5pZCgoZCkgPT4gZC5pZCkuZGlzdGFuY2UoMTAwKSkKICAgIC5mb3JjZSgiY2hhcmdlIiwgZDMuZm9yY2VNYW55Qm9keSgpLnN0cmVuZ3RoKC0zMDApKQogICAgLmZvcmNlKCJjZW50ZXIiLCBkMy5mb3JjZUNlbnRlcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpKTsKCiAgLy8gRGlzZWduYSBpIGxpbmsKICBjb25zdCBsaW5rID0gc3ZnLmFwcGVuZCgiZyIpCiAgICAuc2VsZWN0QWxsKCJsaW5lIikKICAgIC5kYXRhKGdyYXBoRGF0YS5saW5rcykKICAgIC5qb2luKCJsaW5lIikKICAgIC5hdHRyKCJzdHJva2UiLCAiIzk5OSIpCiAgICAuYXR0cigic3Ryb2tlLXdpZHRoIiwgMik7CgogIC8vIERpc2VnbmEgaSBub2RpCiAgY29uc3Qgbm9kZSA9IHN2Zy5hcHBlbmQoImciKQogICAgLnNlbGVjdEFsbCgiY2lyY2xlIikKICAgIC5kYXRhKGdyYXBoRGF0YS5ub2RlcykKICAgIC5qb2luKCJjaXJjbGUiKQogICAgLmF0dHIoInIiLCAxMCkKICAgIC5hdHRyKCJmaWxsIiwgKGQpID0+IGQuZ3JvdXAgPT09IDEgPyAiYmx1ZSIgOiAiZ3JlZW4iKQogICAgLmNhbGwoCiAgICAgIGQzLmRyYWcoKQogICAgICAgIC5vbigic3RhcnQiLCAoZXZlbnQsIGQpID0+IHsKICAgICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDAuMykucmVzdGFydCgpOwogICAgICAgICAgZC5meCA9IGQueDsKICAgICAgICAgIGQuZnkgPSBkLnk7CiAgICAgICAgfSkKICAgICAgICAub24oImRyYWciLCAoZXZlbnQsIGQpID0+IHsKICAgICAgICAgIGQuZnggPSBldmVudC54OwogICAgICAgICAgZC5meSA9IGV2ZW50Lnk7CiAgICAgICAgfSkKICAgICAgICAub24oImVuZCIsIChldmVudCwgZCkgPT4gewogICAgICAgICAgaWYgKCFldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMCk7CiAgICAgICAgICBkLmZ4ID0gbnVsbDsKICAgICAgICAgIGQuZnkgPSBudWxsOwogICAgICAgIH0pLAogICAgKTsKCiAgLy8gQWdnaW9ybmEgcG9zaXppb25pCiAgc2ltdWxhdGlvbi5vbigidGljayIsICgpID0+IHsKICAgIGxpbmsKICAgICAgLmF0dHIoIngxIiwgKGQpID0+IGQuc291cmNlLngpCiAgICAgIC5hdHRyKCJ5MSIsIChkKSA9PiBkLnNvdXJjZS55KQogICAgICAuYXR0cigieDIiLCAoZCkgPT4gZC50YXJnZXQueCkKICAgICAgLmF0dHIoInkyIiwgKGQpID0+IGQudGFyZ2V0LnkpOwoKICAgIG5vZGUKICAgICAgLmF0dHIoImN4IiwgKGQpID0+IGQueCkKICAgICAgLmF0dHIoImN5IiwgKGQpID0+IGQueSk7CiAgfSk7Cn0K",mtime:1732058472079}},functions:{saveGraph:{path:"graph.ts:saveGraph",command:{name:"Save Graph"}},clearGraphData:{path:"graph.ts:clearGraphData",command:{name:"Clear Graph Data"}},graphWidget:{path:"graph.ts:widget",codeWidget:"graph"},hello:{path:"hello.ts:hello",command:{name:"hello"}}}},Sr={manifest:Q,functionMapping:D};b(D,Q);export{Sr as plug};
