var v=Object.defineProperty;var m=(e,r)=>{for(var n in r)v(e,n,{get:r[n],enumerable:!0})};var l=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var p=new Map,u=0;function d(e){self.postMessage(e)}l&&(globalThis.syscall=async(e,...r)=>await new Promise((n,o)=>{u++,p.set(u,{resolve:n,reject:o}),d({type:"sys",id:u,name:e,args:r})}));function f(e,r){l&&(self.addEventListener("message",n=>{(async()=>{let o=n.data;switch(o.type){case"inv":{let i=e[o.name];if(!i)throw new Error(`Function not loaded: ${o.name}`);try{let s=await Promise.resolve(i(...o.args||[]));d({type:"invr",id:o.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",o.name,"error:",s.message),d({type:"invr",id:o.id,error:s.message})}}break;case"sysr":{let i=o.id,s=p.get(i);if(!s)throw Error("Invalid request id");p.delete(i),o.error?s.reject(new Error(o.error)):s.resolve(o.result)}break}})().catch(console.error)}),d({type:"manifest",manifest:r}))}function w(e){let r=atob(e),n=r.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=r.charCodeAt(i);return o}function y(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let r="",n=e.byteLength;for(let o=0;o<n;o++)r+=String.fromCharCode(e[o]);return btoa(r)}async function G(e,r){if(typeof e!="string"){let n=new Uint8Array(await e.arrayBuffer()),o=n.length>0?y(n):void 0;r={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:o},e=e.url}return syscall("sandboxFetch.fetch",e,r)}globalThis.nativeFetch=globalThis.fetch;function K(){globalThis.fetch=async function(e,r){let n=r&&r.body?y(new Uint8Array(await new Response(r.body).arrayBuffer())):void 0,o=await G(e,r&&{method:r.method,headers:r.headers,base64Body:n});return new Response(o.base64Body?w(o.base64Body):null,{status:o.status,headers:o.headers})}}l&&K();var a={};m(a,{confirm:()=>oe,copyToClipboard:()=>le,deleteLine:()=>fe,dispatch:()=>te,downloadFile:()=>V,filterBox:()=>j,flashNotification:()=>J,fold:()=>se,foldAll:()=>de,getCurrentPage:()=>S,getCursor:()=>Z,getSelection:()=>R,getText:()=>k,getUiOption:()=>ne,goHistory:()=>E,hidePanel:()=>O,insertAtCursor:()=>ee,insertAtPos:()=>q,moveCursor:()=>_,moveCursorToLine:()=>$,navigate:()=>L,newWindow:()=>B,openCommandPalette:()=>D,openPageNavigator:()=>Q,openSearchPanel:()=>pe,openUrl:()=>Y,prompt:()=>re,redo:()=>ue,reloadConfigAndCommands:()=>N,reloadPage:()=>T,reloadUI:()=>U,replaceRange:()=>z,save:()=>M,setSelection:()=>W,setText:()=>F,setUiOption:()=>ie,showPanel:()=>H,toggleFold:()=>ge,undo:()=>me,unfold:()=>ae,unfoldAll:()=>ce,uploadFile:()=>X,vimEx:()=>ye});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});function t(e,...r){return globalThis.syscall(e,...r)}function S(){return t("editor.getCurrentPage")}function k(){return t("editor.getText")}function F(e,r=!1){return t("editor.setText",e,r)}function Z(){return t("editor.getCursor")}function R(){return t("editor.getSelection")}function W(e,r){return t("editor.setSelection",e,r)}function M(){return t("editor.save")}function L(e,r=!1,n=!1){return t("editor.navigate",e,r,n)}function Q(e="page"){return t("editor.openPageNavigator",e)}function D(){return t("editor.openCommandPalette")}function T(){return t("editor.reloadPage")}function U(){return t("editor.reloadUI")}function N(){return t("editor.reloadConfigAndCommands")}function Y(e,r=!1){return t("editor.openUrl",e,r)}function B(){return t("editor.newWindow")}function E(e){return t("editor.goHistory",e)}function V(e,r){return t("editor.downloadFile",e,r)}function X(e,r){return t("editor.uploadFile",e,r)}function J(e,r="info"){return t("editor.flashNotification",e,r)}function j(e,r,n="",o=""){return t("editor.filterBox",e,r,n,o)}function H(e,r,n,o=""){return t("editor.showPanel",e,r,n,o)}function O(e){return t("editor.hidePanel",e)}function q(e,r){return t("editor.insertAtPos",e,r)}function z(e,r,n){return t("editor.replaceRange",e,r,n)}function _(e,r=!1){return t("editor.moveCursor",e,r)}function $(e,r=1,n=!1){return t("editor.moveCursorToLine",e,r,n)}function ee(e){return t("editor.insertAtCursor",e)}function te(e){return t("editor.dispatch",e)}function re(e,r=""){return t("editor.prompt",e,r)}function oe(e){return t("editor.confirm",e)}function ne(e){return t("editor.getUiOption",e)}function ie(e,r){return t("editor.setUiOption",e,r)}function se(){return t("editor.fold")}function ae(){return t("editor.unfold")}function ge(){return t("editor.toggleFold")}function de(){return t("editor.foldAll")}function ce(){return t("editor.unfoldAll")}function me(){return t("editor.undo")}function ue(){return t("editor.redo")}function pe(){return t("editor.openSearchPanel")}function le(e){return t("editor.copyToClipboard",e)}function fe(){return t("editor.deleteLine")}function ye(e){return t("editor.vimEx",e)}var c={};m(c,{readAsset:()=>Ke});function Ge(e){let r=atob(e),n=r.length,o=new Uint8Array(n);for(let i=0;i<n;i++)o[i]=r.charCodeAt(i);return o}function h(e){let r=e.split(",",2)[1];return Ge(r)}async function Ke(e,r,n="utf8"){let o=await t("asset.readAsset",e,r);switch(n){case"utf8":return new TextDecoder().decode(h(o));case"dataurl":return o}}var g={};m(g,{batchDel:()=>De,batchGet:()=>Le,batchSet:()=>We,del:()=>Qe,get:()=>Me,listFunctions:()=>Ne,query:()=>Te,queryDelete:()=>Ue,set:()=>Re});function Re(e,r){return t("datastore.set",e,r)}function We(e){return t("datastore.batchSet",e)}function Me(e){return t("datastore.get",e)}function Le(e){return t("datastore.batchGet",e)}function Qe(e){return t("datastore.delete",e)}function De(e){return t("datastore.batchDelete",e)}function Te(e,r={}){return t("datastore.query",e,r)}function Ue(e,r){return t("datastore.queryDelete",e,r)}function Ne(){return t("datastore.listFunctions")}async function C(){let e={nodes:[{id:"Node1",group:1},{id:"Node2",group:1},{id:"Node3",group:2}],links:[{source:"Node1",target:"Node2"},{source:"Node2",target:"Node3"}]};await g.set(["graph","main"],e),await a.flashNotification("Graph saved to datastore!")}async function x(){await g.del(["graph","main"]),await a.flashNotification("Graph data cleared from datastore!")}async function P(e,r){let n=await g.get(["graph","main"]);return n?{html:'<div id="graph-container" style="width: 100%; height: 500px; border: 1px solid #ccc;"></div>',script:`
      loadJsByUrl("https://d3js.org/d3.v7.min.js").then(() => {
        ${await c.readAsset("graph","assets/graph_widget.js")}
        renderGraph(${JSON.stringify(n)});
      });
    `}:{html:"<div>Graph data not found in datastore. Please save a graph first!</div>"}}async function I(){await a.flashNotification("Hello world!")}var A={saveGraph:C,clearGraphData:x,graphWidget:P,hello:I},b={name:"graph",version:.1,imports:["https://get.silverbullet.md/global.plug.json"],assets:{"assets/graph_widget.js":{data:"data:application/javascript;base64,ZnVuY3Rpb24gcmVuZGVyR3JhcGgoZ3JhcGhEYXRhKSB7CiAgY29uc3Qgd2lkdGggPSA2MDAsIGhlaWdodCA9IDQwMDsKCiAgLy8gQ3JlYSBsJ1NWRwogIGNvbnN0IHN2ZyA9IGQzLnNlbGVjdCgiI2dyYXBoLWNvbnRhaW5lciIpCiAgICAuYXBwZW5kKCJzdmciKQogICAgLmF0dHIoIndpZHRoIiwgd2lkdGgpCiAgICAuYXR0cigiaGVpZ2h0IiwgaGVpZ2h0KTsKCiAgLy8gU2ltdWxhemlvbmUgZGkgbGF5b3V0CiAgY29uc3Qgc2ltdWxhdGlvbiA9IGQzLmZvcmNlU2ltdWxhdGlvbihncmFwaERhdGEubm9kZXMpCiAgICAuZm9yY2UoImxpbmsiLCBkMy5mb3JjZUxpbmsoZ3JhcGhEYXRhLmxpbmtzKS5pZCgoZCkgPT4gZC5pZCkuZGlzdGFuY2UoMTAwKSkKICAgIC5mb3JjZSgiY2hhcmdlIiwgZDMuZm9yY2VNYW55Qm9keSgpLnN0cmVuZ3RoKC0zMDApKQogICAgLmZvcmNlKCJjZW50ZXIiLCBkMy5mb3JjZUNlbnRlcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpKTsKCiAgLy8gRGlzZWduYSBpIGxpbmsKICBjb25zdCBsaW5rID0gc3ZnLmFwcGVuZCgiZyIpCiAgICAuc2VsZWN0QWxsKCJsaW5lIikKICAgIC5kYXRhKGdyYXBoRGF0YS5saW5rcykKICAgIC5qb2luKCJsaW5lIikKICAgIC5hdHRyKCJzdHJva2UiLCAiIzk5OSIpCiAgICAuYXR0cigic3Ryb2tlLXdpZHRoIiwgMik7CgogIC8vIERpc2VnbmEgaSBub2RpCiAgY29uc3Qgbm9kZSA9IHN2Zy5hcHBlbmQoImciKQogICAgLnNlbGVjdEFsbCgiY2lyY2xlIikKICAgIC5kYXRhKGdyYXBoRGF0YS5ub2RlcykKICAgIC5qb2luKCJjaXJjbGUiKQogICAgLmF0dHIoInIiLCAxMCkKICAgIC5hdHRyKCJmaWxsIiwgKGQpID0+IGQuZ3JvdXAgPT09IDEgPyAiYmx1ZSIgOiAiZ3JlZW4iKQogICAgLmNhbGwoCiAgICAgIGQzLmRyYWcoKQogICAgICAgIC5vbigic3RhcnQiLCAoZXZlbnQsIGQpID0+IHsKICAgICAgICAgIGlmICghZXZlbnQuYWN0aXZlKSBzaW11bGF0aW9uLmFscGhhVGFyZ2V0KDAuMykucmVzdGFydCgpOwogICAgICAgICAgZC5meCA9IGQueDsKICAgICAgICAgIGQuZnkgPSBkLnk7CiAgICAgICAgfSkKICAgICAgICAub24oImRyYWciLCAoZXZlbnQsIGQpID0+IHsKICAgICAgICAgIGQuZnggPSBldmVudC54OwogICAgICAgICAgZC5meSA9IGV2ZW50Lnk7CiAgICAgICAgfSkKICAgICAgICAub24oImVuZCIsIChldmVudCwgZCkgPT4gewogICAgICAgICAgaWYgKCFldmVudC5hY3RpdmUpIHNpbXVsYXRpb24uYWxwaGFUYXJnZXQoMCk7CiAgICAgICAgICBkLmZ4ID0gbnVsbDsKICAgICAgICAgIGQuZnkgPSBudWxsOwogICAgICAgIH0pLAogICAgKTsKCiAgLy8gQWdnaW9ybmEgcG9zaXppb25pCiAgc2ltdWxhdGlvbi5vbigidGljayIsICgpID0+IHsKICAgIGxpbmsKICAgICAgLmF0dHIoIngxIiwgKGQpID0+IGQuc291cmNlLngpCiAgICAgIC5hdHRyKCJ5MSIsIChkKSA9PiBkLnNvdXJjZS55KQogICAgICAuYXR0cigieDIiLCAoZCkgPT4gZC50YXJnZXQueCkKICAgICAgLmF0dHIoInkyIiwgKGQpID0+IGQudGFyZ2V0LnkpOwoKICAgIG5vZGUKICAgICAgLmF0dHIoImN4IiwgKGQpID0+IGQueCkKICAgICAgLmF0dHIoImN5IiwgKGQpID0+IGQueSk7CiAgfSk7Cn0K",mtime:1732044471118}},functions:{saveGraph:{path:"graph.ts:saveGraph",command:{name:"Save Graph"}},clearGraphData:{path:"graph.ts:clearGraphData",command:{name:"Clear Graph Data"}},graphWidget:{path:"graph.ts:widget",codeWidget:"graph"},hello:{path:"hello.ts:hello",command:{name:"hello"}}}},bt={manifest:b,functionMapping:A};f(A,b);export{bt as plug};
